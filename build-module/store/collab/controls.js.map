{"version":3,"sources":["../../../src/store/collab/controls.js"],"names":["ActionCreators","createRegistryControl","debugUndo","require","applyChangesToYDoc","registry","action","doc","select","getYDoc","isTriggeredByYDoc","blocks","isInitialContent","UPDATE_BLOCKS_WITH_UNDO","UPDATE_BLOCKS_WITHOUT_UNDO","undo","type","undoManager","getUndoManager","redo"],"mappings":"AAAA,SAASA,cAAT,QAA+B,YAA/B;AAEA,SAASC,qBAAT,QAAsC,iBAAtC;;AAEA,MAAMC,SAAS,GAAGC,OAAO,CAAE,OAAF,CAAP,CAAoB,wBAApB,CAAlB;;AAEA,MAAMC,kBAAkB,GAAGH,qBAAqB,CAAII,QAAF,IAAkBC,MAAF,IAAc;AAC/E,QAAMC,GAAG,GAAGF,QAAQ,CAACG,MAAT,CAAiB,iBAAjB,EAAqCC,OAArC,EAAZ;;AAEA,MAAKF,GAAG,IAAI,CAAED,MAAM,CAACI,iBAArB,EAAyC;AACxCH,IAAAA,GAAG,CAACH,kBAAJ,CAAwB;AAAEO,MAAAA,MAAM,EAAEL,MAAM,CAACK;AAAjB,KAAxB,EAAmD;AAAEC,MAAAA,gBAAgB,EAAEN,MAAM,CAACM;AAA3B,KAAnD;AACA;;AAED,SAAON,MAAP;AACA,CAR+C,CAAhD;AAUA,eAAe;AACdO,EAAAA,uBAAuB,EAAET,kBADX;AAEdU,EAAAA,0BAA0B,EAAEV,kBAFd;AAId,GAAEJ,cAAc,CAACe,IAAf,GAAsBC,IAAxB,GAAgCf,qBAAqB,CAAII,QAAF,IAAkBC,MAAF,IAAc;AACpF,UAAMW,WAAW,GAAGZ,QAAQ,CAACG,MAAT,CAAiB,iBAAjB,EAAqCU,cAArC,EAApB;;AAEA,QAAK,CAAED,WAAP,EAAqB;AACpB,aAAOX,MAAP;AACA;;AAEDJ,IAAAA,SAAS,CAAE,MAAF,CAAT;AACAe,IAAAA,WAAW,CAACF,IAAZ;AACA,WAToF,CAS5E;AACR,GAVoD,CAJvC;AAgBd,GAAEf,cAAc,CAACmB,IAAf,GAAsBH,IAAxB,GAAgCf,qBAAqB,CAAII,QAAF,IAAkBC,MAAF,IAAc;AACpF,UAAMW,WAAW,GAAGZ,QAAQ,CAACG,MAAT,CAAiB,iBAAjB,EAAqCU,cAArC,EAApB;;AAEA,QAAK,CAAED,WAAP,EAAqB;AACpB,aAAOX,MAAP;AACA;;AAEDJ,IAAAA,SAAS,CAAE,MAAF,CAAT;AACAG,IAAAA,QAAQ,CAACG,MAAT,CAAiB,iBAAjB,EAAqCU,cAArC,GAAsDC,IAAtD;AACA,WAToF,CAS5E;AACR,GAVoD;AAhBvC,CAAf","sourcesContent":["import { ActionCreators } from 'redux-undo';\n\nimport { createRegistryControl } from '@wordpress/data';\n\nconst debugUndo = require( 'debug' )( 'iso-editor:collab:undo' );\n\nconst applyChangesToYDoc = createRegistryControl( ( registry ) => ( action ) => {\n\tconst doc = registry.select( 'isolated/editor' ).getYDoc();\n\n\tif ( doc && ! action.isTriggeredByYDoc ) {\n\t\tdoc.applyChangesToYDoc( { blocks: action.blocks }, { isInitialContent: action.isInitialContent } );\n\t}\n\n\treturn action;\n} );\n\nexport default {\n\tUPDATE_BLOCKS_WITH_UNDO: applyChangesToYDoc,\n\tUPDATE_BLOCKS_WITHOUT_UNDO: applyChangesToYDoc,\n\n\t[ ActionCreators.undo().type ]: createRegistryControl( ( registry ) => ( action ) => {\n\t\tconst undoManager = registry.select( 'isolated/editor' ).getUndoManager();\n\n\t\tif ( ! undoManager ) {\n\t\t\treturn action;\n\t\t}\n\n\t\tdebugUndo( 'undo' );\n\t\tundoManager.undo();\n\t\treturn; // prevent default action\n\t} ),\n\n\t[ ActionCreators.redo().type ]: createRegistryControl( ( registry ) => ( action ) => {\n\t\tconst undoManager = registry.select( 'isolated/editor' ).getUndoManager();\n\n\t\tif ( ! undoManager ) {\n\t\t\treturn action;\n\t\t}\n\n\t\tdebugUndo( 'redo' );\n\t\tregistry.select( 'isolated/editor' ).getUndoManager().redo();\n\t\treturn; // prevent default action\n\t} ),\n};\n"],"file":"controls.js"}