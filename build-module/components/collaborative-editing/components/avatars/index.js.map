{"version":3,"sources":["../../../../../src/components/collaborative-editing/components/avatars/index.js"],"names":["Popover","VisuallyHidden","withSelect","withDispatch","useState","__","sprintf","compose","CollaborativeEditingAvatars","peers","onAvatarClick","MAX_AVATAR_COUNT","shouldOverflow","length","actualAvatarCount","slice","map","peer","id","CollaborativeEditingAvatar","isVisible","setIsVisible","name","borderColor","color","background","avatarUrl","charAt","CollaborativeEditingAvatarsOverflow","MAX_NAME_COUNT","NameList","select","getCollabPeers","Object","keys","dispatch","selectBlock","start","clientId"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Popover, VisuallyHidden } from '@wordpress/components';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { useState } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\n\n/**\n * @param {Object} props\n * @param {import(\"../..\").AvailablePeer[]} props.peers\n * @param {Function} props.onAvatarClick\n */\nexport function CollaborativeEditingAvatars( { peers, onAvatarClick } ) {\n\tconst MAX_AVATAR_COUNT = 4;\n\tconst shouldOverflow = peers.length > MAX_AVATAR_COUNT;\n\tconst actualAvatarCount = shouldOverflow ? MAX_AVATAR_COUNT - 1 : MAX_AVATAR_COUNT;\n\n\treturn (\n\t\t<div className=\"iso-editor-collab-avatars\">\n\t\t\t<VisuallyHidden>Currently editing:</VisuallyHidden>\n\n\t\t\t{ peers.slice( 0, actualAvatarCount ).map( ( peer ) => (\n\t\t\t\t<CollaborativeEditingAvatar key={ peer.id } peer={ peer } onAvatarClick={ onAvatarClick } />\n\t\t\t) ) }\n\n\t\t\t{ shouldOverflow && <CollaborativeEditingAvatarsOverflow peers={ peers?.slice( actualAvatarCount ) } /> }\n\t\t</div>\n\t);\n}\n\nexport function CollaborativeEditingAvatar( { peer, onAvatarClick } ) {\n\tconst [ isVisible, setIsVisible ] = useState( false );\n\n\treturn (\n\t\t<button\n\t\t\tclassName=\"iso-editor-collab-avatars__avatar-btn\"\n\t\t\taria-label={ peer.name }\n\t\t\tonMouseEnter={ () => setIsVisible( true ) }\n\t\t\tonMouseLeave={ () => setIsVisible( false ) }\n\t\t\tonClick={ () => onAvatarClick( peer ) }\n\t\t\tstyle={ {\n\t\t\t\tborderColor: peer.color,\n\t\t\t\tbackground: peer.color,\n\t\t\t} }\n\t\t>\n\t\t\t{ isVisible && (\n\t\t\t\t<Popover className=\"iso-editor-collab-avatars__popover\" animate={ false }>\n\t\t\t\t\t{ peer.name }\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t{ peer.avatarUrl ? (\n\t\t\t\t<img className=\"iso-editor-collab-avatars__image\" src={ peer.avatarUrl } alt=\"\" />\n\t\t\t) : (\n\t\t\t\t<span className=\"iso-editor-collab-avatars__name-initial\">{ peer.name.charAt( 0 ) }</span>\n\t\t\t) }\n\t\t</button>\n\t);\n}\n\nexport function CollaborativeEditingAvatarsOverflow( { peers } ) {\n\tconst MAX_NAME_COUNT = 20;\n\tconst [ isVisible, setIsVisible ] = useState( false );\n\n\tconst NameList = () => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ul className=\"iso-editor-collab-avatars__overflow-list\">\n\t\t\t\t\t{ peers.slice( 0, MAX_NAME_COUNT ).map( ( peer ) => (\n\t\t\t\t\t\t<li className=\"iso-editor-collab-avatars__overflow-list-item\" key={ peer.id }>\n\t\t\t\t\t\t\t{ peer.name }\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) ) }\n\t\t\t\t</ul>\n\t\t\t\t{ peers.length > MAX_NAME_COUNT && (\n\t\t\t\t\t<p className=\"iso-editor-collab-avatars__overflow-more\">\n\t\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t\t/* translators: %s: number of how many more users there are */\n\t\t\t\t\t\t\t__( 'and %s more' ),\n\t\t\t\t\t\t\tpeers.length - MAX_NAME_COUNT\n\t\t\t\t\t\t) }\n\t\t\t\t\t</p>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t};\n\n\treturn (\n\t\t<div className=\"iso-editor-collab-avatars__overflow\">\n\t\t\t{ isVisible && (\n\t\t\t\t<Popover className=\"iso-editor-collab-avatars__popover\" animate={ false }>\n\t\t\t\t\t<NameList />\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t<span\n\t\t\t\taria-hidden=\"true\"\n\t\t\t\tonMouseEnter={ () => setIsVisible( true ) }\n\t\t\t\tonMouseLeave={ () => setIsVisible( false ) }\n\t\t\t>\n\t\t\t\t{ `+${ peers.length }` }\n\t\t\t</span>\n\t\t\t<VisuallyHidden>\n\t\t\t\t<NameList />\n\t\t\t</VisuallyHidden>\n\t\t</div>\n\t);\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst peers = select( 'isolated/editor' ).getCollabPeers();\n\n\t\treturn {\n\t\t\tpeers: Object.keys( peers ).map( ( id ) => {\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\t...peers[ id ],\n\t\t\t\t};\n\t\t\t} ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { selectBlock } = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tonAvatarClick( peer ) {\n\t\t\t\tif ( peer?.start?.clientId ) {\n\t\t\t\t\tselectBlock( peer.start.clientId );\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t} ),\n] )( CollaborativeEditingAvatars );\n"],"file":"index.js"}