{"version":3,"sources":["../../../../../src/components/block-editor-contents/use-yjs/algorithms/yjs.js"],"names":["yjs","isEqual","simpleDiff","a","b","left","right","length","index","remove","insert","slice","updateBlocksDoc","yDocBlocks","blocks","clientId","has","set","Map","order","get","Array","byClientId","currentOrder","toArray","orderDiff","map","block","forEach","_clientId","includes","delete","_block","innerBlocks","updateCommentsDoc","commentsDoc","comments","comment","currentDoc","_id","isNewDoc","field","updateCommentRepliesDoc","replies","repliesDoc","reply","currentReplyDoc","updatePostDoc","doc","newPost","postDoc","title","commentsDocToArray","Object","entries","toJSON","id","commentDoc","type","content","createdAt","status","start","end","authorId","authorName","replyId","entryDoc","sort","blocksDocToArray","postDocToObject"],"mappings":"AAAA;AAEA,OAAO,KAAKA,GAAZ,MAAqB,KAArB;AACA,SAASC,OAAT,QAAwB,QAAxB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,UAAT,CAAqBC,CAArB,EAAwBC,CAAxB,EAA4B;AAC3B,MAAIC,IAAI,GAAG,CAAX;AACA,MAAIC,KAAK,GAAG,CAAZ;;AACA,SAAQD,IAAI,GAAGF,CAAC,CAACI,MAAT,IAAmBF,IAAI,GAAGD,CAAC,CAACG,MAA5B,IAAsCJ,CAAC,CAAEE,IAAF,CAAD,KAAcD,CAAC,CAAEC,IAAF,CAA7D,EAAwE;AACvEA,IAAAA,IAAI;AACJ;;AACD,MAAKA,IAAI,KAAKF,CAAC,CAACI,MAAX,IAAqBF,IAAI,KAAKD,CAAC,CAACG,MAArC,EAA8C;AAC7C,WACCD,KAAK,GAAGD,IAAR,GAAeF,CAAC,CAACI,MAAjB,IACAD,KAAK,GAAGD,IAAR,GAAeD,CAAC,CAACG,MADjB,IAEAJ,CAAC,CAAEA,CAAC,CAACI,MAAF,GAAWD,KAAX,GAAmB,CAArB,CAAD,KAA8BF,CAAC,CAAEA,CAAC,CAACG,MAAF,GAAWD,KAAX,GAAmB,CAArB,CAHhC,EAIE;AACDA,MAAAA,KAAK;AACL;AACD;;AACD,SAAO;AACNE,IAAAA,KAAK,EAAEH,IADD;AAENI,IAAAA,MAAM,EAAEN,CAAC,CAACI,MAAF,GAAWF,IAAX,GAAkBC,KAFpB;AAGNI,IAAAA,MAAM,EAAEN,CAAC,CAACO,KAAF,CAASN,IAAT,EAAeD,CAAC,CAACG,MAAF,GAAWD,KAA1B;AAHF,GAAP;AAKA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,OAAO,SAASM,eAAT,CAA0BC,UAA1B,EAAsCC,MAAtC,EAA8CC,QAAQ,GAAG,EAAzD,EAA8D;AACpE,MAAK,CAAEF,UAAU,CAACG,GAAX,CAAgB,OAAhB,CAAP,EAAmC;AAClCH,IAAAA,UAAU,CAACI,GAAX,CAAgB,OAAhB,EAAyB,IAAIjB,GAAG,CAACkB,GAAR,EAAzB;AACA;;AACD,MAAIC,KAAK,GAAGN,UAAU,CAACO,GAAX,CAAgB,OAAhB,CAAZ;AACA,MAAK,CAAED,KAAK,CAACH,GAAN,CAAWD,QAAX,CAAP,EAA+BI,KAAK,CAACF,GAAN,CAAWF,QAAX,EAAqB,IAAIf,GAAG,CAACqB,KAAR,EAArB;AAC/BF,EAAAA,KAAK,GAAGA,KAAK,CAACC,GAAN,CAAWL,QAAX,CAAR;;AACA,MAAK,CAAEF,UAAU,CAACG,GAAX,CAAgB,YAAhB,CAAP,EAAwC;AACvCH,IAAAA,UAAU,CAACI,GAAX,CAAgB,YAAhB,EAA8B,IAAIjB,GAAG,CAACkB,GAAR,EAA9B;AACA;;AACD,QAAMI,UAAU,GAAGT,UAAU,CAACO,GAAX,CAAgB,YAAhB,CAAnB;AACA,QAAMG,YAAY,GAAGJ,KAAK,CAACK,OAAN,EAArB;AACA,QAAMC,SAAS,GAAGvB,UAAU,CAC3BqB,YAD2B,EAE3BT,MAAM,CAACY,GAAP,CAAcC,KAAF,IAAaA,KAAK,CAACZ,QAA/B,CAF2B,CAA5B;AAIAQ,EAAAA,YAAY,CACVZ,KADF,CACSc,SAAS,CAACjB,KADnB,EAC0BiB,SAAS,CAAChB,MADpC,EAEEmB,OAFF,CAGIC,SAAF,IACC,CAAEJ,SAAS,CAACf,MAAV,CAAiBoB,QAAjB,CAA2BD,SAA3B,CAAF,IACAP,UAAU,CAACS,MAAX,CAAmBF,SAAnB,CALH;AAOAV,EAAAA,KAAK,CAACY,MAAN,CAAcN,SAAS,CAACjB,KAAxB,EAA+BiB,SAAS,CAAChB,MAAzC;AACAU,EAAAA,KAAK,CAACT,MAAN,CAAce,SAAS,CAACjB,KAAxB,EAA+BiB,SAAS,CAACf,MAAzC;;AAEA,OAAM,MAAMsB,MAAZ,IAAsBlB,MAAtB,EAA+B;AAC9B,UAAM;AAAEmB,MAAAA,WAAF;AAAe,SAAGN;AAAlB,QAA4BK,MAAlC;;AACA,QACC,CAAEV,UAAU,CAACN,GAAX,CAAgBW,KAAK,CAACZ,QAAtB,CAAF,IACA,CAAEd,OAAO,CAAEqB,UAAU,CAACF,GAAX,CAAgBO,KAAK,CAACZ,QAAtB,CAAF,EAAoCY,KAApC,CAFV,EAGE;AACDL,MAAAA,UAAU,CAACL,GAAX,CAAgBU,KAAK,CAACZ,QAAtB,EAAgCY,KAAhC;AACA;;AAEDf,IAAAA,eAAe,CAAEC,UAAF,EAAcoB,WAAd,EAA2BN,KAAK,CAACZ,QAAjC,CAAf;AACA;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASmB,iBAAT,CAA4BC,WAA5B,EAAyCC,QAAQ,GAAG,EAApD,EAAyD;AAC/DA,EAAAA,QAAQ,CAACR,OAAT,CAAoBS,OAAF,IAAe;AAChC,QAAIC,UAAU,GAAGH,WAAW,CAACf,GAAZ,CAAiBiB,OAAO,CAACE,GAAzB,CAAjB;AACA,UAAMC,QAAQ,GAAG,CAAEF,UAAnB;;AACA,QAAK,CAAEA,UAAP,EAAoB;AACnBH,MAAAA,WAAW,CAAClB,GAAZ,CAAiBoB,OAAO,CAACE,GAAzB,EAA8B,IAAIvC,GAAG,CAACkB,GAAR,EAA9B;AACA;;AACDoB,IAAAA,UAAU,GAAGH,WAAW,CAACf,GAAZ,CAAiBiB,OAAO,CAACE,GAAzB,CAAb,CANgC,CAOhC;;AACA,KACC,MADD,EAEC,SAFD,EAGC,WAHD,EAIC,QAJD,EAKC,OALD,EAMC,KAND,EAOC,UAPD,EAQC,YARD,EASEX,OATF,CASaa,KAAF,IAAa;AACvB,UAAKD,QAAQ,IAAIF,UAAU,CAAClB,GAAX,CAAgBqB,KAAhB,MAA4BJ,OAAO,CAAEI,KAAF,CAApD,EAAgE;AAC/DH,QAAAA,UAAU,CAACrB,GAAX,CAAgBwB,KAAhB,EAAuBJ,OAAO,CAAEI,KAAF,CAA9B;AACA;AACD,KAbD;;AAeA,QAAKD,QAAL,EAAgB;AACfF,MAAAA,UAAU,CAACrB,GAAX,CAAgB,SAAhB,EAA2B,IAAIjB,GAAG,CAACkB,GAAR,EAA3B;AACA;;AAEDwB,IAAAA,uBAAuB,CAAEJ,UAAU,CAAClB,GAAX,CAAgB,SAAhB,CAAF,EAA+BiB,OAAO,CAACM,OAAvC,CAAvB;AACA,GA5BD;AA6BA;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASD,uBAAT,CAAkCE,UAAlC,EAA8CD,OAAO,GAAG,EAAxD,EAA6D;AACnEA,EAAAA,OAAO,CAACf,OAAR,CAAmBiB,KAAF,IAAa;AAC7B,QAAIC,eAAe,GAAGF,UAAU,CAACxB,GAAX,CAAgByB,KAAK,CAACN,GAAtB,CAAtB;AACA,UAAMC,QAAQ,GAAG,CAAEM,eAAnB;;AACA,QAAK,CAAEA,eAAP,EAAyB;AACxBF,MAAAA,UAAU,CAAC3B,GAAX,CAAgB4B,KAAK,CAACN,GAAtB,EAA2B,IAAIvC,GAAG,CAACkB,GAAR,EAA3B;AACA;;AACD4B,IAAAA,eAAe,GAAGF,UAAU,CAACxB,GAAX,CAAgByB,KAAK,CAACN,GAAtB,CAAlB;AACA,KAAE,SAAF,EAAa,WAAb,EAA0B,UAA1B,EAAsC,YAAtC,EAAqDX,OAArD,CACGa,KAAF,IAAa;AACZ,UACCD,QAAQ,IACRM,eAAe,CAAC1B,GAAhB,CAAqBqB,KAArB,MAAiCI,KAAK,CAAEJ,KAAF,CAFvC,EAGE;AACDK,QAAAA,eAAe,CAAC7B,GAAhB,CAAqBwB,KAArB,EAA4BI,KAAK,CAAEJ,KAAF,CAAjC;AACA;AACD,KARF;AAUA,GAjBD;AAkBA;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASM,aAAT,CAAwBC,GAAxB,EAA6BC,OAA7B,EAAuC;AAC7C,QAAMC,OAAO,GAAGF,GAAG,CAAC5B,GAAJ,CAAS,MAAT,EAAiBpB,GAAG,CAACkB,GAArB,CAAhB;;AACA,MAAKgC,OAAO,CAAC9B,GAAR,CAAa,OAAb,MAA2B6B,OAAO,CAACE,KAAxC,EAAgD;AAC/CD,IAAAA,OAAO,CAACjC,GAAR,CAAa,OAAb,EAAsBgC,OAAO,CAACE,KAA9B;AACA;;AACD,MAAK,CAAED,OAAO,CAAC9B,GAAR,CAAa,QAAb,EAAuBpB,GAAG,CAACkB,GAA3B,CAAP,EAA0C;AACzCgC,IAAAA,OAAO,CAACjC,GAAR,CAAa,QAAb,EAAuB,IAAIjB,GAAG,CAACkB,GAAR,EAAvB;AACA;;AACDN,EAAAA,eAAe,CAAEsC,OAAO,CAAC9B,GAAR,CAAa,QAAb,CAAF,EAA2B6B,OAAO,CAACnC,MAAR,IAAkB,EAA7C,CAAf;;AACA,MAAK,CAAEoC,OAAO,CAAC9B,GAAR,CAAa,UAAb,EAAyBpB,GAAG,CAACkB,GAA7B,CAAP,EAA4C;AAC3CgC,IAAAA,OAAO,CAACjC,GAAR,CAAa,UAAb,EAAyB,IAAIjB,GAAG,CAACkB,GAAR,EAAzB;AACA;;AACDgB,EAAAA,iBAAiB,CAAEgB,OAAO,CAAC9B,GAAR,CAAa,UAAb,CAAF,EAA6B6B,OAAO,CAACb,QAArC,CAAjB;AACA;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASgB,kBAAT,CAA6BjB,WAA7B,EAA2C;AACjD,MAAK,CAAEA,WAAP,EAAqB;AACpB,WAAO,EAAP;AACA;;AAED,SAAOkB,MAAM,CAACC,OAAP,CAAgBnB,WAAW,CAACoB,MAAZ,EAAhB,EAAuC7B,GAAvC,CACN,CAAE,CAAE8B,EAAF,EAAMC,UAAN,CAAF,KAA0B;AACzB,WAAO;AACNlB,MAAAA,GAAG,EAAEiB,EADC;AAENE,MAAAA,IAAI,EAAED,UAAU,CAACC,IAFX;AAGNC,MAAAA,OAAO,EAAEF,UAAU,CAACE,OAHd;AAINC,MAAAA,SAAS,EAAEH,UAAU,CAACG,SAJhB;AAKNC,MAAAA,MAAM,EAAEJ,UAAU,CAACI,MALb;AAMNC,MAAAA,KAAK,EAAEL,UAAU,CAACK,KANZ;AAONC,MAAAA,GAAG,EAAEN,UAAU,CAACM,GAPV;AAQNC,MAAAA,QAAQ,EAAEP,UAAU,CAACO,QARf;AASNC,MAAAA,UAAU,EAAER,UAAU,CAACQ,UATjB;AAUNtB,MAAAA,OAAO,EAAEU,MAAM,CAACC,OAAP,CAAgBG,UAAU,CAACd,OAA3B,EACPjB,GADO,CACF,CAAE,CAAEwC,OAAF,EAAWC,QAAX,CAAF,KAA6B;AAClC,eAAO;AACN5B,UAAAA,GAAG,EAAE2B,OADC;AAENP,UAAAA,OAAO,EAAEQ,QAAQ,CAACR,OAFZ;AAGNC,UAAAA,SAAS,EAAEO,QAAQ,CAACP,SAHd;AAINI,UAAAA,QAAQ,EAAEG,QAAQ,CAACH,QAJb;AAKNC,UAAAA,UAAU,EAAEE,QAAQ,CAACF;AALf,SAAP;AAOA,OATO,EAUPG,IAVO,CAUD,CAAEjE,CAAF,EAAKC,CAAL,KAAYD,CAAC,CAACyD,SAAF,GAAcxD,CAAC,CAACwD,SAV3B;AAVH,KAAP;AAsBA,GAxBK,CAAP;AA0BA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASS,gBAAT,CAA2BxD,UAA3B,EAAuCE,QAAQ,GAAG,EAAlD,EAAuD;AAAA;;AAC7D,MAAK,CAAEF,UAAP,EAAoB;AACnB,WAAO,EAAP;AACA;;AACD,MAAIM,KAAK,GAAGN,UAAU,CAACO,GAAX,CAAgB,OAAhB,CAAZ;AACAD,EAAAA,KAAK,iBAAGA,KAAK,CAACC,GAAN,CAAWL,QAAX,CAAH,+CAAG,WAAuBS,OAAvB,EAAR;AACA,MAAK,CAAEL,KAAP,EAAe,OAAO,EAAP;AACf,QAAMG,UAAU,GAAGT,UAAU,CAACO,GAAX,CAAgB,YAAhB,CAAnB;AAEA,SAAOD,KAAK,CAACO,GAAN,CAAaG,SAAF,KAAmB,EACpC,GAAGP,UAAU,CAACF,GAAX,CAAgBS,SAAhB,CADiC;AAEpCI,IAAAA,WAAW,EAAEoC,gBAAgB,CAAExD,UAAF,EAAcgB,SAAd;AAFO,GAAnB,CAAX,CAAP;AAIA;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASyC,eAAT,CAA0BtB,GAA1B,EAAgC;AACtC,QAAME,OAAO,GAAGF,GAAG,CAAC5B,GAAJ,CAAS,MAAT,EAAiBpB,GAAG,CAACkB,GAArB,CAAhB;AACA,QAAMJ,MAAM,GAAGuD,gBAAgB,CAAEnB,OAAO,CAAC9B,GAAR,CAAa,QAAb,CAAF,CAA/B;AACA,QAAMgB,QAAQ,GAAGgB,kBAAkB,CAAEF,OAAO,CAAC9B,GAAR,CAAa,UAAb,CAAF,CAAnC;AAEA,SAAO;AACN+B,IAAAA,KAAK,EAAED,OAAO,CAAC9B,GAAR,CAAa,OAAb,KAA0B,EAD3B;AAENN,IAAAA,MAFM;AAGNsB,IAAAA;AAHM,GAAP;AAKA","sourcesContent":["// @ts-nocheck TODO\n\nimport * as yjs from 'yjs';\nimport { isEqual } from 'lodash';\n\n/**\n * Returns information for splicing array `a` into array `b`,\n * by swapping the minimum slice of disagreement.\n *\n * @param {Array} a\n * @param {Array} b\n * @return {Object} diff.\n */\nfunction simpleDiff( a, b ) {\n\tlet left = 0;\n\tlet right = 0;\n\twhile ( left < a.length && left < b.length && a[ left ] === b[ left ] ) {\n\t\tleft++;\n\t}\n\tif ( left !== a.length || left !== b.length ) {\n\t\twhile (\n\t\t\tright + left < a.length &&\n\t\t\tright + left < b.length &&\n\t\t\ta[ a.length - right - 1 ] === b[ b.length - right - 1 ]\n\t\t) {\n\t\t\tright++;\n\t\t}\n\t}\n\treturn {\n\t\tindex: left,\n\t\tremove: a.length - left - right,\n\t\tinsert: b.slice( left, b.length - right ),\n\t};\n}\n\n/**\n * Updates the block doc with the local blocks block changes.\n *\n * @param {yjs.Map} yDocBlocks Blocks doc.\n * @param {Array}   blocks     Updated blocks.\n * @param {string}  clientId   Current clientId.\n */\nexport function updateBlocksDoc( yDocBlocks, blocks, clientId = '' ) {\n\tif ( ! yDocBlocks.has( 'order' ) ) {\n\t\tyDocBlocks.set( 'order', new yjs.Map() );\n\t}\n\tlet order = yDocBlocks.get( 'order' );\n\tif ( ! order.has( clientId ) ) order.set( clientId, new yjs.Array() );\n\torder = order.get( clientId );\n\tif ( ! yDocBlocks.has( 'byClientId' ) ) {\n\t\tyDocBlocks.set( 'byClientId', new yjs.Map() );\n\t}\n\tconst byClientId = yDocBlocks.get( 'byClientId' );\n\tconst currentOrder = order.toArray();\n\tconst orderDiff = simpleDiff(\n\t\tcurrentOrder,\n\t\tblocks.map( ( block ) => block.clientId )\n\t);\n\tcurrentOrder\n\t\t.slice( orderDiff.index, orderDiff.remove )\n\t\t.forEach(\n\t\t\t( _clientId ) =>\n\t\t\t\t! orderDiff.insert.includes( _clientId ) &&\n\t\t\t\tbyClientId.delete( _clientId )\n\t\t);\n\torder.delete( orderDiff.index, orderDiff.remove );\n\torder.insert( orderDiff.index, orderDiff.insert );\n\n\tfor ( const _block of blocks ) {\n\t\tconst { innerBlocks, ...block } = _block;\n\t\tif (\n\t\t\t! byClientId.has( block.clientId ) ||\n\t\t\t! isEqual( byClientId.get( block.clientId ), block )\n\t\t) {\n\t\t\tbyClientId.set( block.clientId, block );\n\t\t}\n\n\t\tupdateBlocksDoc( yDocBlocks, innerBlocks, block.clientId );\n\t}\n}\n\n/**\n * Updates the comments doc with the local comments changes.\n *\n * @param {yjs.Doc} commentsDoc  comments doc.\n * @param {Object}  comments     Updated comments.\n */\nexport function updateCommentsDoc( commentsDoc, comments = [] ) {\n\tcomments.forEach( ( comment ) => {\n\t\tlet currentDoc = commentsDoc.get( comment._id );\n\t\tconst isNewDoc = ! currentDoc;\n\t\tif ( ! currentDoc ) {\n\t\t\tcommentsDoc.set( comment._id, new yjs.Map() );\n\t\t}\n\t\tcurrentDoc = commentsDoc.get( comment._id );\n\t\t// Update regular fields\n\t\t[\n\t\t\t'type',\n\t\t\t'content',\n\t\t\t'createdAt',\n\t\t\t'status',\n\t\t\t'start',\n\t\t\t'end',\n\t\t\t'authorId',\n\t\t\t'authorName',\n\t\t].forEach( ( field ) => {\n\t\t\tif ( isNewDoc || currentDoc.get( field ) !== comment[ field ] ) {\n\t\t\t\tcurrentDoc.set( field, comment[ field ] );\n\t\t\t}\n\t\t} );\n\n\t\tif ( isNewDoc ) {\n\t\t\tcurrentDoc.set( 'replies', new yjs.Map() );\n\t\t}\n\n\t\tupdateCommentRepliesDoc( currentDoc.get( 'replies' ), comment.replies );\n\t} );\n}\n\n/**\n * Updates the replies doc with the local replies changes.\n *\n * @param {yjs.Doc} repliesDoc  replies doc.\n * @param {Object}  replies     Updated replies.\n */\nexport function updateCommentRepliesDoc( repliesDoc, replies = [] ) {\n\treplies.forEach( ( reply ) => {\n\t\tlet currentReplyDoc = repliesDoc.get( reply._id );\n\t\tconst isNewDoc = ! currentReplyDoc;\n\t\tif ( ! currentReplyDoc ) {\n\t\t\trepliesDoc.set( reply._id, new yjs.Map() );\n\t\t}\n\t\tcurrentReplyDoc = repliesDoc.get( reply._id );\n\t\t[ 'content', 'createdAt', 'authorId', 'authorName' ].forEach(\n\t\t\t( field ) => {\n\t\t\t\tif (\n\t\t\t\t\tisNewDoc ||\n\t\t\t\t\tcurrentReplyDoc.get( field ) !== reply[ field ]\n\t\t\t\t) {\n\t\t\t\t\tcurrentReplyDoc.set( field, reply[ field ] );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t} );\n}\n\n/**\n * Updates the post doc with the local post changes.\n *\n * @param {yjs.Doc} doc     Shared doc.\n * @param {Object}  newPost Updated post.\n */\nexport function updatePostDoc( doc, newPost ) {\n\tconst postDoc = doc.get( 'post', yjs.Map );\n\tif ( postDoc.get( 'title' ) !== newPost.title ) {\n\t\tpostDoc.set( 'title', newPost.title );\n\t}\n\tif ( ! postDoc.get( 'blocks', yjs.Map ) ) {\n\t\tpostDoc.set( 'blocks', new yjs.Map() );\n\t}\n\tupdateBlocksDoc( postDoc.get( 'blocks' ), newPost.blocks || [] );\n\tif ( ! postDoc.get( 'comments', yjs.Map ) ) {\n\t\tpostDoc.set( 'comments', new yjs.Map() );\n\t}\n\tupdateCommentsDoc( postDoc.get( 'comments' ), newPost.comments );\n}\n\n/**\n * Converts the comments doc into a comment list.\n *\n * @param {yjs.Map} commentsDoc Comments doc.\n * @return {Array} Comment list.\n */\nexport function commentsDocToArray( commentsDoc ) {\n\tif ( ! commentsDoc ) {\n\t\treturn [];\n\t}\n\n\treturn Object.entries( commentsDoc.toJSON() ).map(\n\t\t( [ id, commentDoc ] ) => {\n\t\t\treturn {\n\t\t\t\t_id: id,\n\t\t\t\ttype: commentDoc.type,\n\t\t\t\tcontent: commentDoc.content,\n\t\t\t\tcreatedAt: commentDoc.createdAt,\n\t\t\t\tstatus: commentDoc.status,\n\t\t\t\tstart: commentDoc.start,\n\t\t\t\tend: commentDoc.end,\n\t\t\t\tauthorId: commentDoc.authorId,\n\t\t\t\tauthorName: commentDoc.authorName,\n\t\t\t\treplies: Object.entries( commentDoc.replies )\n\t\t\t\t\t.map( ( [ replyId, entryDoc ] ) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t_id: replyId,\n\t\t\t\t\t\t\tcontent: entryDoc.content,\n\t\t\t\t\t\t\tcreatedAt: entryDoc.createdAt,\n\t\t\t\t\t\t\tauthorId: entryDoc.authorId,\n\t\t\t\t\t\t\tauthorName: entryDoc.authorName,\n\t\t\t\t\t\t};\n\t\t\t\t\t} )\n\t\t\t\t\t.sort( ( a, b ) => a.createdAt - b.createdAt ),\n\t\t\t};\n\t\t}\n\t);\n}\n\n/**\n * Converts the block doc into a block list.\n *\n * @param {yjs.Map} yDocBlocks Block doc.\n * @param {string}  clientId   Current block clientId.\n * @return {Array} Block list.\n */\nexport function blocksDocToArray( yDocBlocks, clientId = '' ) {\n\tif ( ! yDocBlocks ) {\n\t\treturn [];\n\t}\n\tlet order = yDocBlocks.get( 'order' );\n\torder = order.get( clientId )?.toArray();\n\tif ( ! order ) return [];\n\tconst byClientId = yDocBlocks.get( 'byClientId' );\n\n\treturn order.map( ( _clientId ) => ( {\n\t\t...byClientId.get( _clientId ),\n\t\tinnerBlocks: blocksDocToArray( yDocBlocks, _clientId ),\n\t} ) );\n}\n\n/**\n * Converts the post doc into a post object.\n *\n * @param {yjs.Map} doc Shared doc.\n * @return {Object} Post object.\n */\nexport function postDocToObject( doc ) {\n\tconst postDoc = doc.get( 'post', yjs.Map );\n\tconst blocks = blocksDocToArray( postDoc.get( 'blocks' ) );\n\tconst comments = commentsDocToArray( postDoc.get( 'comments' ) );\n\n\treturn {\n\t\ttitle: postDoc.get( 'title' ) || '',\n\t\tblocks,\n\t\tcomments,\n\t};\n}\n"],"file":"yjs.js"}