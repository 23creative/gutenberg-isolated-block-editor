{"version":3,"sources":["../../../src/components/block-editor/post-text-editor.js"],"names":["Textarea","__","Component","withSelect","withDispatch","withInstanceId","compose","parse","serialize","PostTextEditor","constructor","props","edit","bind","stopEditing","state","getDerivedStateFromProps","isDirty","value","event","target","onChange","setState","onPersist","render","instanceId","select","getBlocks","dispatch","updateBlocksWithoutUndo","content","blocks"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport Textarea from 'react-autosize-textarea';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { withInstanceId, compose } from '@wordpress/compose';\nimport { parse, serialize } from '@wordpress/blocks';\n\nexport class PostTextEditor extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.edit = this.edit.bind( this );\n\t\tthis.stopEditing = this.stopEditing.bind( this );\n\n\t\tthis.state = {};\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\tif ( state.isDirty ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tvalue: props.value,\n\t\t\tisDirty: false,\n\t\t};\n\t}\n\n\t/**\n\t * Handles a textarea change event to notify the onChange prop callback and\n\t * reflect the new value in the component's own state. This marks the start\n\t * of the user's edits, if not already changed, preventing future props\n\t * changes to value from replacing the rendered value. This is expected to\n\t * be followed by a reset to dirty state via `stopEditing`.\n\t *\n\t * @see stopEditing\n\t *\n\t * @param {Event} event Change event.\n\t */\n\tedit( event ) {\n\t\t// @ts-ignore */}\n\t\tconst value = event.target.value;\n\t\tthis.props.onChange( value );\n\t\tthis.setState( { value, isDirty: true } );\n\t}\n\n\t/**\n\t * Function called when the user has completed their edits, responsible for\n\t * ensuring that changes, if made, are surfaced to the onPersist prop\n\t * callback and resetting dirty state.\n\t */\n\tstopEditing() {\n\t\tif ( this.state.isDirty ) {\n\t\t\tthis.props.onPersist( this.state.value );\n\t\t\tthis.setState( { isDirty: false } );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { value } = this.state;\n\t\tconst { instanceId } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor={ `post-content-${ instanceId }` }\n\t\t\t\t\tclassName=\"screen-reader-text\"\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Type text or HTML' ) }\n\t\t\t\t</label>\n\t\t\t\t<Textarea\n\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\tdir=\"auto\"\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\t// @ts-ignore */}\n\t\t\t\t\tonChange={ this.edit }\n\t\t\t\t\tonBlur={ this.stopEditing }\n\t\t\t\t\tclassName=\"editor-post-text-editor\"\n\t\t\t\t\tid={ `post-content-${ instanceId }` }\n\t\t\t\t\tplaceholder={ __( 'Start writing with text or HTML' ) }\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { getBlocks } = select( 'isolated/editor' );\n\t\treturn {\n\t\t\tvalue: serialize( getBlocks() ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { updateBlocksWithoutUndo } = dispatch( 'isolated/editor' );\n\t\treturn {\n\t\t\tonChange( content ) {\n\t\t\t\tconst blocks = parse( content );\n\t\t\t\tupdateBlocksWithoutUndo( blocks );\n\t\t\t},\n\t\t\tonPersist( content ) {\n\t\t\t\tconst blocks = parse( content );\n\t\t\t\tupdateBlocksWithoutUndo( blocks );\n\t\t\t},\n\t\t};\n\t} ),\n\twithInstanceId,\n] )( PostTextEditor );\n"],"file":"post-text-editor.js"}