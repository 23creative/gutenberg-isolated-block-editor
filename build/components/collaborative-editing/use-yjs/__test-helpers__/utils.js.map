{"version":3,"sources":["../../../../../src/components/collaborative-editing/use-yjs/__test-helpers__/utils.js"],"names":["getTransports","count","peers","getAvailablePeers","excludeId","Object","values","reduce","acc","p","user","id","mockTransport","transport","_identity","undefined","connect","jest","fn","onReceiveMessage","setAvailablePeers","identity","keys","forEach","Promise","resolve","isFirstInChannel","length","sendMessage","data","disconnect","Array","fill","map","pauseTyping","screen","getAllByRole","el","blur","setTimeout"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { waitFor } from '@testing-library/react';\n\n/**\n * Helper to generate mock transport modules for an isolated channel.\n *\n * @param {number} count - Number of transport modules to generate.\n * @return {Object[]} - Array of transport modules.\n */\nexport function getTransports( count ) {\n\tconst peers = {};\n\n\tconst getAvailablePeers = ( excludeId ) =>\n\t\tObject.values( peers ).reduce( ( acc, p ) => {\n\t\t\tif ( p.user.id === excludeId ) return acc;\n\t\t\treturn [ ...acc, p.user ];\n\t\t}, [] );\n\n\tconst mockTransport = () => {\n\t\tconst transport = {\n\t\t\t_identity: undefined,\n\t\t\tconnect: jest.fn( ( { onReceiveMessage, setAvailablePeers, user } ) => {\n\t\t\t\ttransport._identity = user.identity;\n\t\t\t\tpeers[ user.identity ] = { onReceiveMessage, setAvailablePeers, user: { ...user, id: user.identity } };\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tpeers[ identity ].setAvailablePeers( getAvailablePeers( identity ) );\n\t\t\t\t} );\n\t\t\t\treturn Promise.resolve( { isFirstInChannel: Object.keys( peers ).length === 1 } );\n\t\t\t} ),\n\t\t\tsendMessage: jest.fn( ( data ) => {\n\t\t\t\t// console.log( data.message.messageType, data.identity.substring( 0, 4 ) );\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tif ( identity !== data.identity ) {\n\t\t\t\t\t\tpeers[ identity ].onReceiveMessage( data );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} ),\n\t\t\tdisconnect: jest.fn( () => {\n\t\t\t\tdelete peers[ transport._identity ];\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tpeers[ identity ].setAvailablePeers( getAvailablePeers( identity ) );\n\t\t\t\t} );\n\t\t\t} ),\n\t\t};\n\n\t\treturn transport;\n\t};\n\n\treturn Array( count )\n\t\t.fill( null )\n\t\t.map( () => mockTransport() );\n}\n\n/**\n * Emulate a pause between typing events for Yjs to make a new undo stack item.\n *\n * Requires jest.useRealTimers().\n *\n * @param {import('@testing-library/dom').Screen} screen\n */\nexport async function pauseTyping( screen ) {\n\tscreen.getAllByRole( 'document' ).forEach( ( el ) => el.blur() );\n\tawait waitFor( () => new Promise( ( resolve ) => setTimeout( resolve, 550 ) ) );\n}\n"],"file":"utils.js"}